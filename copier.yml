# Template configuration
_subdirectory: template
_templates_suffix: .j2

# Exclude patterns (files and folders that won't be copied)
_exclude:
    - 'template/helpers'
    - 'template/helpers/*.j2'
    - 'helpers'
    - 'helpers/*.j2'
    - '!template'
    - 'CLAUDE.md'

# Post-generation tasks
_tasks:
    - env
    # Require direnv for proper environment setup
    - 'type direnv >/dev/null 2>&1 || { echo "Error: direnv is required but not installed. Please install direnv first."; exit 1; }'

    # Allow the envrc before any direnv exec commands
    - 'direnv allow {{ _copier_conf.dst_path }}/.envrc'

    # Install Python version with pyenv if available
    - 'if type pyenv >/dev/null 2>&1; then pyenv install --skip-existing {{ python_version }}; else echo "pyenv not found, skipping Python version setup"; fi'

    # Initialize git repository
    - 'cd {{ _copier_conf.dst_path }} && git init'

    # Install uv and sync dependencies using direnv exec for proper environment
    - 'direnv exec {{ _copier_conf.dst_path }} sh -c "python --version && pip install uv && uv sync --all-extras --all-groups --no-binary"'

    # Initialize pre-commit if available
    - 'direnv exec {{ _copier_conf.dst_path }} sh -c "uv tool run pre-commit install"'

    # Launch Claude Code with design session if requested
    - command: 'if type claude >/dev/null 2>&1; then claude --prompt "I just generated a new Python project called {{project_name}} using a template. The module name is {{module_name}} and it currently has placeholder content. Please interview me to understand what this project should do, then help me write a proper README.md and update the package description in pyproject.toml. Ask me about the project purpose, target audience, key features, and any specific requirements." .; else echo "Claude Code not found, skipping design session"; fi'
      working_directory: '{{ _copier_conf.dst_path }}'
      when: '{{ claude_design_session and launch_claude_code }}'

    # Launch Claude Code without design session if requested
    - command: 'if type claude >/dev/null 2>&1; then claude .; else echo "Claude Code not found, skipping auto-launch"; fi'
      working_directory: '{{ _copier_conf.dst_path }}'
      when: '{{ launch_claude_code and not claude_design_session }}'

# questions
project_name:
    type: str
    help: What is your project's name?

module_name:
    type: str
    help: What is your Python module name?
    default: "{%- include 'template/helpers/module-default.j2' -%}"

package_name:
    type: str
    help: What is your Python package name?
    default: "{%- include 'template/helpers/package-name.j2' -%}"

python_version:
    type: str
    help: Select Python version to use with pyenv
    default: '3.11'

user_name:
    type: str
    default: "Scott Hyndman"

user_email:
    type: str
    default: "scotty.hyndman@gmail.com"

github_user:
    type: str
    default: "shyndman"

include_ci_workflow:
    type: bool
    default: true
    help: Include CI workflow with Ruff, Pyright, and pytest?

include_docker_workflow:
    type: bool
    default: false
    help: Include Docker build and publish workflow?

launch_claude_code:
    type: bool
    default: true
    help: Launch Claude Code after project generation?

claude_design_session:
    type: bool
    default: true
    help: Have Claude help design your project README and description?
